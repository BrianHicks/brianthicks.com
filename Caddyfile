{$DOMAIN} {
  root source/public
  tls {$TLS}
  gzip
  log stdout

  git {$REPO} {
    path ../
    hook "/update-hook" {$HOOK_SECRET}
    then rm -rf public
    then git submodule update --init --recursive
    then hugo
  }

  # redirect old URLs
  redir /2012/03/19/dict-syntax /post/{path}
  redir /2012/03/19/django-test-settings /post/{path}
  redir /2012/03/19/javascript-dates /post/{path}
  redir /2012/05/29/graph-task-dependencies-with-python /post/{path}
  redir /2013/09/13/post-script /post/{path}
  redir /2013/09/13/temptation-of-pypy /post/{path}
  redir /2014/03/20/stl-python-class-complete /post/{path}
  redir /2014/10/16/speed-up-pip-install-with-wheel /post/{path}
  redir /2014/10/29/announcing-setattr-your-python-toolbox /post/{path}
  redir /2014/10/30/growing /post/{path}
  redir /2014/11/03/build-modular-command-line-tools-with-click /post/{path}
  redir /2014/11/10/speedy-sets /post/{path}
  redir /2014/12/01/test-apis-properly-with-vcr-py /post/{path}
  redir /2014/12/08/setattr-season-1 /post/{path}
  redir /2014/12/28/so-hows-setattr-going /post/{path}
  redir /2015/01/05/im-sick-im-shipping-tomorrow-anyway /post/{path}
  redir /2015/04/15/automate-your-python-environment-with-pyenv /post/{path}
  redir /2015/06/04/introducing-terraform-py /post/{path}
}